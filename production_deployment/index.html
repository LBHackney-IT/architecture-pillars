<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/architecture-pillars/blog/rss.xml" title="Hackney Architecture Pillars Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/architecture-pillars/blog/atom.xml" title="Hackney Architecture Pillars Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney Architecture Pillars" href="/architecture-pillars/opensearch.xml"><title data-react-helmet="true">Production Deployment | Hackney Architecture Pillars</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Production Deployment | Hackney Architecture Pillars"><meta data-react-helmet="true" name="description" content="Context"><meta data-react-helmet="true" property="og:description" content="Context"><meta data-react-helmet="true" property="og:url" content="https://github.com/LBHackney-IT/architecture-pillars/architecture-pillars/production_deployment"><link data-react-helmet="true" rel="shortcut icon" href="/architecture-pillars/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://github.com/LBHackney-IT/architecture-pillars/architecture-pillars/production_deployment"><link rel="stylesheet" href="/architecture-pillars/styles.cd915cb9.css">
<link rel="stylesheet" href="/architecture-pillars/main.4a16e2e4.css">
<link rel="preload" href="/architecture-pillars/styles.59ce4859.js" as="script">
<link rel="preload" href="/architecture-pillars/runtime~main.fb458387.js" as="script">
<link rel="preload" href="/architecture-pillars/main.d98cc4a5.js" as="script">
<link rel="preload" href="/architecture-pillars/1.d704cc14.js" as="script">
<link rel="preload" href="/architecture-pillars/2.cfa801d4.js" as="script">
<link rel="preload" href="/architecture-pillars/29.861029c2.js" as="script">
<link rel="preload" href="/architecture-pillars/32.a55e7306.js" as="script">
<link rel="preload" href="/architecture-pillars/935f2afb.77f91658.js" as="script">
<link rel="preload" href="/architecture-pillars/17896441.cc7c9bcb.js" as="script">
<link rel="preload" href="/architecture-pillars/2b17dcc3.026d6aea.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/architecture-pillars/"><img src="/architecture-pillars/img/logo-long.svg" alt="Architecture Pillars" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/architecture-pillars/img/logo-long.svg" alt="Architecture Pillars" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Architecture Pillars</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/architecture-pillars" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/architecture-pillars/"><img src="/architecture-pillars/img/logo-long.svg" alt="Architecture Pillars" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/architecture-pillars/img/logo-long.svg" alt="Architecture Pillars" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Architecture Pillars</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/LBHackney-IT/architecture-pillars" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/architecture-pillars/">Introduction</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Architecture Pillars</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Reliabilty</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/architecture-pillars/production_deployment">Production Deployment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/architecture-pillars/preferred_data_source">Preferred types of databases and when to use</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/architecture-pillars/core_resource_compliance">Core AWS resources compliance checks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/architecture-pillars/automated_remediation">AWS Config for enabling automated remediation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Scalibility</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/preferred_data_source">Preferred types of databases and when to use</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/auto_scaling">Auto-scaling for AWS resources used in Software Engineering</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Security</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/core_resource_compliance">Core AWS resources compliance checks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/dev_least_principles">Developer Least Priviledge Principles</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Cost Optimisation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/auto_scaling">Auto-scaling for AWS resources used in Software Engineering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/cloudwatch_log_retention">CloudWatch Log Retention Policy</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">High Availability and Performance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/architecture-pillars/preferred_data_source">Preferred types of databases and when to use</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/architecture-pillars/production_deployment">Production Deployment</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Development Principles and Quality Assurance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/testing_standards">HackIT Testing Standards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/data_driven">HackIT Data Driven Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/api_compliance">API Compliance Checklist</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/qa_process">Enhancing the Quality Assurance process in Hackney through the use of automation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/repository_standards">Managing our GitHub repositories‚Äô branches</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/minimum_qa_standard">Minimum QA testing requirements in Hackney‚Äôs Software Development Lifecycle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/developer_onboarding">Developer technical on-boarding</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/data_modelling">Data Modelling Principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/adr">Architecture Decision Records</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/api_spec_asessment_process">API Specifications Assessment Process</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/data_meetup_template">Data Meetup Template</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/architecture-pillars/release_process">Managing API Releases</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/architecture-pillars/contact_us">Contact Our Development Team</a></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Production Deployment</h1></header><div class="markdown"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="context"></a>Context<a class="hash-link" href="#context" title="Direct link to heading">#</a></h3><p>This document outlines the infrastructure requirements and considerations for production services. It is intended to be used as a guide and as a reference point to ensure that live services deployed to a production environment are compliant with the infrastructure requirements for production deployments. </p><p>The list groups aspects based on Hackney‚Äôs defined architecture pillars and <strong>is concerned with</strong> resources provisioned as part of service delivery <strong>and not</strong> the overall platform requirements.</p><p>All services deployed to production will be assessed against the points listed in the <a href="#checklist">Checklist</a> section of this document. </p><p>A guide outlining the steps for API testing for production deployment can be found <a href="https://playbook.hackney.gov.uk/API-Playbook/production_testing" target="_blank" rel="noopener noreferrer">here</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="checklist"></a>Checklist<a class="hash-link" href="#checklist" title="Direct link to heading">#</a></h3><p><strong>Please Note:</strong> Not all points will be applicable to resource types used by different projects. It is the responsibility of each team lead to assess which points relate to resources used by the given project and ensure they are followed.</p><p><strong>Security</strong></p><ol><li><a href="#encryption">Data is encrypted at rest</a> for:<ul><li>AWS RDS</li><li>AWS SNS</li><li>AWS OpenSearch</li><li>AWS S3</li><li>AWS MSK (Amazon Managed Streaming for Apache Kafka)</li><li>AWS DynamoDB</li><li>AWS Redshift</li></ul></li><li><a href="#api-endpoints-protection-via-an-authentication-mechanism">All API Gateway endpoints, with the exception of Swagger documentation, are secured via an authorizer</a> </li><li><a href="#no-publicly-accessible-resources">No publicly accessible resources</a><ul><li><a href="#aws-s3">AWS S3 blocks public access</a></li><li><a href="#aws-lambda">AWS Lambda do not have too permissive resource policies attached and are hosted in a VPC if applicable</a> </li><li><a href="#aws-rds">AWS RDS instances are blocking public access and are hosted in a private subnet</a></li><li><a href="#aws-opensearch">AWS OpenSearch clusters are hosted in a private subnet</a></li></ul></li></ol><p><strong>High availability</strong></p><ol><li><a href="#multi-az-deployment">Resources have been deployed across 3 availability zones</a></li><li><a href="#read-replicas-for-rds-databases">RDS databases have read replicas enabled to support failover</a></li></ol><p><strong>Monitoring and alerting</strong></p><ol><li><a href="#apis-availability">AWS CloudWatch canaries to monitor availability are set up for APIs</a></li><li><a href="#logging">Logging and retention of logs are configured as per available policies</a></li><li><a href="#api-cloudwatch-alarms">API alarms are set up to monitor for 5xx errors and canaries outcome</a></li><li><a href="#cloudwatch-dashboards">CloudWatch dashboards are set up for improved monitoring</a></li><li><a href="#request-tracing">AWS X-Ray is enabled for APIs</a></li><li><a href="#eda-for-apis---monitoring-and-data-loss-prevention">Alarms and notification mechanisms are in place for scenarios when a message fails to be delivered via SNS</a></li><li><a href="#eda-for-apis---monitoring-and-data-loss-prevention">The EDA setup for APIs includes mechanisms to prevent data loss</a></li></ol><p><strong>Reliability</strong></p><ol><li><a href="#pitr-for-dynamodb">DynamoDB PITR is enabled</a></li><li><a href="#back-up-tags">All AWS resources storing data have been assigned backup tags with the correct value</a></li></ol><p><strong>Cost optimization</strong></p><ol><li><a href="#choosing-the-right-database-solution">Database technology is DynamoDB (for NoSQL), RDS Postgres (for SQL) or S3 (for file storage) unless otherwise evaluated and agreed upon.</a></li><li><a href="#use-of-indexes-in-dynamodb">DynamoDB tables do not have more than 2 GSIs</a></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="high-availability"></a>High availability<a class="hash-link" href="#high-availability" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="multi-az-deployment"></a>Multi AZ deployment<a class="hash-link" href="#multi-az-deployment" title="Direct link to heading">#</a></h3><p>Each service must have components (e.g. AWS RDS database) deployed across multiple AWS availability zones to ensure high availability.</p><p>AWS based components, such as S3 and DynamoDB, which have built-in high availability features are an exception to this rule.</p><p>Building a service, which is deployed across multiple availability zones, makes it compliant with HackIT‚Äôs disaster recovery plan and requirements. [LINK TO DR PLAN AND REQUIREMENTS]</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="minimum-number-of-availability-zones"></a>Minimum number of availability zones<a class="hash-link" href="#minimum-number-of-availability-zones" title="Direct link to heading">#</a></h3><p>Each production service must be deployed to 3 availability zones as per best practices to promote reliability and high availability.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="read-replicas-for-rds-databases"></a>Read replicas for RDS databases<a class="hash-link" href="#read-replicas-for-rds-databases" title="Direct link to heading">#</a></h2><p>All Hackney RDS databases should have a read replica database configured for Production environments as per industry best practices and benefits outlined below. </p><ul><li><p>A read replica is a secondary database instance that supports asynchronous replication for the data in a primary database. As the name suggests, unless promoted to a primary instance, the read replica supports only read requests.</p></li><li><p>Read replicas for RDS instances provide improved performance and availability for any relational database hosted in AWS RDS.</p></li></ul><p>At Hackney, many of the datasets that services are built around do not change as often, resulting in database requests being mainly of read-only nature. This also includes various ETL processes for extracting data for reporting purposes. </p><p><em>Improved performance</em>
Routing read requests to a read replica database instance reduces the load on the primary database instance. As per AWS official documentation, ‚ÄúRead replicas allow you to elastically scale out beyond the capacity constraints of a single DB instance for read-heavy database workloads‚Äù. Read replicas should be set up for Production databases to ensure reduced risk of database server issues by reducing the read-heavy load. </p><p><em>Increased availability</em>
Read replicas are also part of improving the resilience of our architecture - in case of a failover, a read replica will get promoted to the primary instance, reducing the disruption to the digital services Hackney provides to the minimum.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="security"></a>Security<a class="hash-link" href="#security" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="encryption"></a>Encryption<a class="hash-link" href="#encryption" title="Direct link to heading">#</a></h3><p>All services that store data (permanently or as part of a transfer process such as events streaming) must encrypt the data at rest.</p><p>Encrypting data is important as it provides additional security in the event that a hacker obtains the data directly from the data centres infrastructure where it is stored - without the decryption keys, the data would not be accessible. Further to this, for resources encrypted with customer managed keys (CMKs), consuming resources will need to be provided with permissions to decrypt the data using those keys. This limits exposure to data if an isolated service is compromised. </p><p>Encrypting data at rest also makes Hackney compliant with regulatory requirements.</p><p>Services that must have encryption at rest enabled:</p><ul><li>AWS S3</li><li>AWS RDS</li><li>AWS SNS</li><li>AWS OpenSearch</li><li>AWS DynamoDB</li><li>AWS Redshift</li><li>AWS MSK</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="api-endpoints-protection-via-an-authentication-mechanism"></a>API endpoints protection via an authentication mechanism<a class="hash-link" href="#api-endpoints-protection-via-an-authentication-mechanism" title="Direct link to heading">#</a></h3><p>Hackney uses a custom <a href="https://playbook.hackney.gov.uk/API-Playbook/generating_tokens" target="_blank" rel="noopener noreferrer">Lambda authorizer</a> to provide authentication for API endpoints in AWS API Gateway.</p><p>The authorizer utilises the existing <a href="https://github.com/LBHackney-IT/LBH-Google-auth" target="_blank" rel="noopener noreferrer">Google auth solution</a> to obtain information about the end user and determine if they should be allowed to invoke an API endpoint based on their Google group membership. The authorizer also supports service authentication flow. Full documentation can be found <a href="https://playbook.hackney.gov.uk/API-Playbook/generating_tokens" target="_blank" rel="noopener noreferrer">here</a>  </p><p>To prevent user error, where a developer might accidentally forget to enable an authentication mechanism for an API endpoint, all APIs must include a <a href="https://playbook.hackney.gov.uk/API-Playbook/serverless_safegaurd" target="_blank" rel="noopener noreferrer">serverless safeguard</a>, which checks and stops deployment if an authorizer is not added to a given API Gateway endpoint, as part of their serverless.yml configuration. </p><p>Example PR of changes required to implement the serverless safeguard to make the API authorizer required can be found <a href="https://github.com/LBHackney-IT/lbh-base-api/pull/64" target="_blank" rel="noopener noreferrer">here</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="no-publicly-accessible-resources"></a>No publicly accessible resources<a class="hash-link" href="#no-publicly-accessible-resources" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aws-s3"></a>AWS S3<a class="hash-link" href="#aws-s3" title="Direct link to heading">#</a></h3><p>All buckets <strong>should be blocking</strong> public access. The only exception to this rule is if the bucket is used to serve publicly available assets, such as website images.</p><p>For buckets used for website hosting, the website should be made available via AWS CloudFront and not directly via the S3 bucket as described in Hackney‚Äôs preferred architecture approaches for web services here.[INSERT LINK] </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aws-lambda"></a>AWS Lambda<a class="hash-link" href="#aws-lambda" title="Direct link to heading">#</a></h3><p>Lambda functions <strong>must not</strong> have resource policies that allow for public invocation of the function.</p><p>Further to this, if a Lambda function interacts with a database hosted in a private subnet, then the Lambda function <strong>must be placed</strong> in the same VPC and private subnet to ensure end-to-end security protection. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aws-rds"></a>AWS RDS<a class="hash-link" href="#aws-rds" title="Direct link to heading">#</a></h3><p>All AWS RDS instances <strong>must have</strong> the ‚Äúpublicly accessible‚Äù property set to <strong>false</strong>.</p><p>In addition, all database instances <strong>must be hosted</strong> in a private subnet to not allow access via the internet and thus reduce the security risk and possible attack scope.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aws-opensearch"></a>AWS OpenSearch<a class="hash-link" href="#aws-opensearch" title="Direct link to heading">#</a></h3><p>All OpenSearch clusters  <strong>must be hosted</strong> in a private subnet to not allow access via the internet and thus reduce the security risk and possible attack scope.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="monitoring-and-alerting"></a>Monitoring and alerting<a class="hash-link" href="#monitoring-and-alerting" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="monitoring"></a>Monitoring<a class="hash-link" href="#monitoring" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="apis-availability"></a>APIs availability<a class="hash-link" href="#apis-availability" title="Direct link to heading">#</a></h4><p>Hackney‚Äôs Base API template includes a health check controller that is used to set up AWS CloudWatch Synthetic Canaries for availability monitoring.</p><p>The health check is configured to test if the API is up and running, as well as to test and verify if a connection to the datastore that the API interacts with is successful. </p><p>All existing and new APIs <strong>must utilise the health check functionality and configure the canaries</strong> to monitor the availability of the API and underlying datastore <strong>every 5 minutes</strong>. The provisioning of the AWS CloudWatch Canary is automated via Serverless - an example can be found here.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="logging"></a>Logging<a class="hash-link" href="#logging" title="Direct link to heading">#</a></h4><p>Most of the application logs for services in Hackney are stored in AWS CloudWatch (some exceptions apply for front end services, which utilise other third party tools such as Sentry for logging).</p><p>For logs stored in CloudWatch, log groups must have a retention period setup of a minimum of 6 months and a maximum of 8 months as per <a href="https://docs.google.com/document/d/1nqSI0_wWhEbZ-3c4dF4vJDlmt5mf0doX8togUv9lT7c/edit" target="_blank" rel="noopener noreferrer">CloudWatch logs retention policy</a></p><p>Logging requirements are outlined in the <a href="https://docs.google.com/document/d/1RhkbwSG4t_a6_4gzafvwX3H7P_KJC-MIpcwbAJ-7W5c/edit" target="_blank" rel="noopener noreferrer">Event &amp; Log Management Policy and Standard</a>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cloudwatch-dashboards"></a>CloudWatch dashboards<a class="hash-link" href="#cloudwatch-dashboards" title="Direct link to heading">#</a></h4><p>CloudWatch dashboards provide a visual representation of various logs/alarms being monitored. Their main benefit is that they provide a consolidated view of resources monitored that relate to the same service and can include widgets that extract error logs, saving time for engineers that would otherwise have to search through a number of log groups to identify error logs.</p><p>Hackney is in the process of creating multiple terraform modules to speed up the creation of CloudWatch dashboards by grouping widgets related to common AWS resources used by projects.</p><p>Available terraform modules for APIs and Listeners dashboards can be found <a href="https://github.com/LBHackney-IT/aws-hackney-common-terraform/tree/master/modules/cloudwatch/dashboards" target="_blank" rel="noopener noreferrer">here</a>.</p><p>All production services should make use of available dashboard modules and/or build their custom monitoring dashboard to promote faster incident resolution by providing a visual representation of the state of services and reduce the time taken to identify cause of issues.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="request-tracing"></a>Request tracing<a class="hash-link" href="#request-tracing" title="Direct link to heading">#</a></h4><p>AWS X-Ray is an AWS managed service that provides the functionality to debug and analyse distributed applications.</p><p><a href="https://docs.aws.amazon.com/xray/latest/devguide/aws-xray.html" target="_blank" rel="noopener noreferrer">AWS X-Ray official documentation</a></p><p>X-Ray provides an end-to-end request view that includes all components of a request, such as the API Gateway, any other Lambda functions invoked as part of the API code execution and the connection to the underlying database.</p><p>The tool is used for identifying the root cause of an issue, discovering performance bottlenecks and seeing real-time data regarding high latency requests.
AWS X-Ray collects logs and makes use of a Service Map to visualise the dependencies and calls to other services made in an API request. </p><p>Services should have X-Ray enabled to improve the monitoring process for services and provide engineers and support analysts to quickly identify which of the components invoked as part of the request is the cause of a given issue.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="alerting"></a>Alerting<a class="hash-link" href="#alerting" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="api-cloudwatch-alarms"></a>API CloudWatch alarms<a class="hash-link" href="#api-cloudwatch-alarms" title="Direct link to heading">#</a></h3><p>All APIs must have the following CloudWatch alarms set up to notify members of the team actively maintaining the API of any issues that have occurred.</p><ol><li>CloudWatch Canary alarm - if a canary detects that an API is unavailable, an alarm must be triggered. <ul><li>Terraform module can be found <a href="https://github.com/LBHackney-IT/aws-hackney-common-terraform/tree/master/modules/cloudwatch/canary-alarm" target="_blank" rel="noopener noreferrer">here</a>.</li></ul></li><li>API 5xx error alarm - if an API encounters one or more 5xx errors, the alarm must be triggered.
T   - Terraform module can be found <a href="https://github.com/LBHackney-IT/aws-hackney-common-terraform/blob/master/modules/cloudwatch/api-alarm/main.tf" target="_blank" rel="noopener noreferrer">here</a></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="eda-for-apis---monitoring-and-data-loss-prevention"></a>EDA for APIs - monitoring and data loss prevention<a class="hash-link" href="#eda-for-apis---monitoring-and-data-loss-prevention" title="Direct link to heading">#</a></h2><p>Hackney uses a combination of SNS and SQS to implement events-driven architecture. The EDA approach is used to synchronise microservices and their respective data stores.</p><p>As part of the setup, a message is published to a single SNS topic and distributed to one or multiple consuming SQS queues. To ensure a message is delivered to all consumers, SNS <strong>must have</strong> ‚Äã‚Äãdelivery status logging set to <strong>enabled</strong>. In the event of a failure to deliver a message, an alarm must be triggered and the relevant engineers, who provide support for the data synchronised via the given SNS topic, must be notified. </p><p>In addition to this, to ensure no data loss occurs for message that fail to be processed by one or more of the listeners, engineers must be notified if a message is inserted in a dead-letter queue (DLQ) and any pending messages in the DQL, that have been reviewed, must be stored in S3 prior to the retention period expiry.</p><p>Full details of implementation can be found here. [Insert link]</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="reliability"></a>Reliability<a class="hash-link" href="#reliability" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="back-ups"></a>Back ups<a class="hash-link" href="#back-ups" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pitr-for-dynamodb"></a>PITR for DynamoDB<a class="hash-link" href="#pitr-for-dynamodb" title="Direct link to heading">#</a></h4><p>Point-in-time-recovery is a DynamoDB feature that allows for data in a table to be restored in the event of an incident.</p><p>All production services that store data in DynamoDB must have PITR enabled to ensure that even if data gets accidentally deleted or the table becomes corrupted, the data can be restored.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="back-up-tags"></a>Back up tags<a class="hash-link" href="#back-up-tags" title="Direct link to heading">#</a></h4><p>Hackney has set up automated centralised backing for the different types of AWS based data stores used in projects. </p><p>All applicable production AWS services must include the backup tags in the resource configuration to ensure those are backed up. </p><p>The full guide can be found here - <a href="https://docs.google.com/document/d/1aUVOvCMOV9frrmcExMh2pZSGQPOdvNFMbFsNqHUQbWQ/edit?usp=sharing" target="_blank" rel="noopener noreferrer">How to HackIT - AWS Backup</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cost-optimisation"></a>Cost optimisation<a class="hash-link" href="#cost-optimisation" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="choosing-the-right-database-solution"></a>Choosing the right database solution<a class="hash-link" href="#choosing-the-right-database-solution" title="Direct link to heading">#</a></h3><p>Hackney‚Äôs development team has preferred database technologies to use which contribute towards consistency, ensuring future maintenance and providing optimal cost. Those databases should be used for projects on a ‚Äúyes, unless‚Äù basis, where exceptions could be made if a product has requirements that cannot be fulfilled by the suggested database solutions.</p><p>Guidance for choosing between SQL and NoSQL databases can be found here - <a href="/architecture-pillars/data_driven">Data Driven</a>.</p><p><em>What technology to use?</em>
For relational databases, please use <strong>RDS Postgres</strong>.</p><p>For NoSQL needs, please use <strong>DynamoDB</strong>.</p><p>For files storage, please use <strong>S3</strong>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="use-of-indexes-in-dynamodb"></a>Use of indexes in DynamoDB<a class="hash-link" href="#use-of-indexes-in-dynamodb" title="Direct link to heading">#</a></h3><p>In some scenarios, based on the data structure and record retrieval requirements, Global Secondary Indexes (GSIs) might be required for DynamoDB to avoid using ‚ÄòScan‚Äô operations, which are costly and not as performant.</p><p>However, GSIs should not be overused as there is a cost associated with creating those - each GSI is effectively a copy of the table with a different sort and range key. </p><p>Each project using DynamoDB <strong>should not use more than two</strong> GSIs in DynamoDB. If retrieval requirements are not satisfied with up to two GSIs, then alternative methods of retrieving a record should be pursued, such as implementing a Search endpoint that utilises AWS OpenSearch.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/LBHackney-IT/architecture-pillars/edit/master/docs/production_deployment.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/architecture-pillars/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/architecture-pillars/preferred_data_source"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Preferred types of databases and when to use ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#context" class="table-of-contents__link">Context</a></li><li><a href="#checklist" class="table-of-contents__link">Checklist</a></li><li><a href="#high-availability" class="table-of-contents__link">High availability</a><ul><li><a href="#multi-az-deployment" class="table-of-contents__link">Multi AZ deployment</a></li><li><a href="#minimum-number-of-availability-zones" class="table-of-contents__link">Minimum number of availability zones</a></li></ul></li><li><a href="#read-replicas-for-rds-databases" class="table-of-contents__link">Read replicas for RDS databases</a></li><li><a href="#security" class="table-of-contents__link">Security</a><ul><li><a href="#encryption" class="table-of-contents__link">Encryption</a></li><li><a href="#api-endpoints-protection-via-an-authentication-mechanism" class="table-of-contents__link">API endpoints protection via an authentication mechanism</a></li></ul></li><li><a href="#no-publicly-accessible-resources" class="table-of-contents__link">No publicly accessible resources</a><ul><li><a href="#aws-s3" class="table-of-contents__link">AWS S3</a></li><li><a href="#aws-lambda" class="table-of-contents__link">AWS Lambda</a></li><li><a href="#aws-rds" class="table-of-contents__link">AWS RDS</a></li><li><a href="#aws-opensearch" class="table-of-contents__link">AWS OpenSearch</a></li></ul></li><li><a href="#monitoring-and-alerting" class="table-of-contents__link">Monitoring and alerting</a><ul><li><a href="#monitoring" class="table-of-contents__link">Monitoring</a></li></ul></li><li><a href="#alerting" class="table-of-contents__link">Alerting</a><ul><li><a href="#api-cloudwatch-alarms" class="table-of-contents__link">API CloudWatch alarms</a></li></ul></li><li><a href="#eda-for-apis---monitoring-and-data-loss-prevention" class="table-of-contents__link">EDA for APIs - monitoring and data loss prevention</a></li><li><a href="#reliability" class="table-of-contents__link">Reliability</a><ul><li><a href="#back-ups" class="table-of-contents__link">Back ups</a></li></ul></li><li><a href="#cost-optimisation" class="table-of-contents__link">Cost optimisation</a><ul><li><a href="#choosing-the-right-database-solution" class="table-of-contents__link">Choosing the right database solution</a></li><li><a href="#use-of-indexes-in-dynamodb" class="table-of-contents__link">Use of indexes in DynamoDB</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/architecture-pillars/styles.59ce4859.js"></script>
<script src="/architecture-pillars/runtime~main.fb458387.js"></script>
<script src="/architecture-pillars/main.d98cc4a5.js"></script>
<script src="/architecture-pillars/1.d704cc14.js"></script>
<script src="/architecture-pillars/2.cfa801d4.js"></script>
<script src="/architecture-pillars/29.861029c2.js"></script>
<script src="/architecture-pillars/32.a55e7306.js"></script>
<script src="/architecture-pillars/935f2afb.77f91658.js"></script>
<script src="/architecture-pillars/17896441.cc7c9bcb.js"></script>
<script src="/architecture-pillars/2b17dcc3.026d6aea.js"></script>
</body>
</html>